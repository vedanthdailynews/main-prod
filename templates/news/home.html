{% extends 'base.html' %}

{% block extra_head %}
{% if fetching_now %}<meta http-equiv="refresh" content="15">{% endif %}
{% endblock %}

{% block content %}
{% comment %}
  HOME PAGE ‚Äî India First Layout
  Sections: Hero | üáÆüá≥ India Today | üåç International | Latest (paginated)
{% endcomment %}
<div class="container mt-3">

  {% comment %} ‚îÄ‚îÄ Breaking News Header ‚îÄ‚îÄ {% endcomment %}
  <div class="d-flex align-items-center mb-4 p-2 rounded-1" style="background:#fff5f7;border-left:4px solid #c8102e;border:1px solid #f5c6cf;">
    <span style="background:#c8102e;color:#fff;font-size:.72rem;font-weight:700;letter-spacing:.8px;padding:3px 9px;border-radius:3px;text-transform:uppercase;white-space:nowrap;"><i class="fas fa-bolt me-1"></i>Breaking</span>
    <div style="overflow:hidden;flex:1;margin-left:12px;">
      <div class="marquee-track" style="white-space:nowrap;animation:marqueeScroll 40s linear infinite;display:inline-block;font-size:.83rem;color:#333;">
        {% for article in articles|slice:":8" %}{{ article.title|truncatewords:10 }} &nbsp;&nbsp;&bull;&nbsp;&nbsp; {% endfor %}
      </div>
    </div>
  </div>
  <style>
    @keyframes marqueeScroll { 0%{transform:translateX(40%)} 100%{transform:translateX(-100%)} }
    a:hover .second-hero-img { transform: scale(1.05); }
    a:hover .news-card { box-shadow: 0 14px 32px rgba(0,0,0,0.12), 0 4px 10px rgba(0,0,0,0.06); transform: translateY(-4px); }
  </style>

  {% if hero_article %}
  <section class="hero-section mb-4">
    <div class="row g-3">
      <div class="col-lg-8 d-flex flex-column gap-3">

        <!-- ‚îÄ‚îÄ Main Hero Card ‚îÄ‚îÄ -->
        <div class="news-card hero-card position-relative overflow-hidden flex-shrink-0" style="border-radius:12px;">
          {% if hero_article.image_url %}
          <img src="{{ hero_article.image_url }}" alt="{{ hero_article.title }}"
               style="width:100%;height:380px;object-fit:cover;display:block;">
          {% else %}
          <div style="width:100%;height:380px;background:linear-gradient(135deg,#c8102e,#1a1a1a);"></div>
          {% endif %}
          <div class="p-4 d-flex flex-column justify-content-end"
               style="position:absolute;bottom:0;left:0;right:0;
                      background:linear-gradient(transparent,rgba(0,0,0,0.88));color:#fff;">
            {% if hero_article.is_indian_news %}
            <span class="badge mb-2" style="background:#FF9933;color:#fff;width:fit-content;font-size:.75rem;border-radius:20px;">üáÆüá≥ India</span>
            {% else %}
            <span class="badge mb-2 bg-danger" style="width:fit-content;font-size:.75rem;border-radius:20px;">Breaking</span>
            {% endif %}
            <h1 style="font-family:'Merriweather',serif;font-size:1.55rem;font-weight:900;line-height:1.3;">
              <a href="{% url 'news:detail' hero_article.pk %}" class="text-decoration-none text-white">{{ hero_article.title }}</a>
            </h1>
            <p class="mb-1" style="font-size:.88rem;opacity:.85;">{{ hero_article.description|truncatewords:22 }}</p>
            <small style="opacity:.7;"><i class="far fa-clock"></i> {{ hero_article.published_at|timesince }} ago</small>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ Two compact article cards filling the blank below hero ‚îÄ‚îÄ -->
        <div class="row g-2 flex-grow-1">
          {% for sec in international_articles|slice:":2" %}
          <div class="col-6">
            <a href="{% url 'news:detail' sec.pk %}" class="text-decoration-none d-block h-100">
              <div class="news-card d-flex overflow-hidden h-100" style="border-radius:10px;min-height:155px;border-top:3px solid #1a1a1a;">
                {% if sec.image_url %}
                <div style="flex:0 0 110px;overflow:hidden;">
                  <img src="{{ sec.image_url }}" alt="{{ sec.title }}"
                       style="width:110px;height:100%;min-height:155px;object-fit:cover;display:block;transition:transform 0.35s ease;"
                       onmouseover="this.style.transform='scale(1.06)'" onmouseout="this.style.transform='scale(1)'">
                </div>
                {% else %}
                <div style="flex:0 0 110px;background:linear-gradient(135deg,#1a1a1a,#555);display:flex;align-items:center;justify-content:center;min-height:155px;">
                  <i class="fas fa-globe" style="font-size:1.8rem;color:rgba(255,255,255,.3);"></i>
                </div>
                {% endif %}
                <div class="p-2 d-flex flex-column justify-content-between" style="flex:1;overflow:hidden;">
                  <div>
                    {% if sec.category %}<span style="font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#c8102e;">{{ sec.get_category_display }}</span>{% endif %}
                    <p style="font-family:'Merriweather',serif;font-size:.8rem;font-weight:700;line-height:1.35;color:#1a1a1a;margin:3px 0 4px;">{{ sec.title|truncatewords:11 }}</p>
                    <p style="font-size:.72rem;color:#777;line-height:1.4;margin:0;">{{ sec.description|truncatewords:10 }}</p>
                  </div>
                  <small style="font-size:.68rem;color:#aaa;"><i class="far fa-clock me-1"></i>{{ sec.published_at|timesince }} ago</small>
                </div>
              </div>
            </a>
          </div>
          {% endfor %}
        </div>

      </div>
      <div class="col-lg-4">
        <div class="sidebar p-3 d-flex flex-column" style="background:#fafafa;border-radius:12px;border-top:4px solid #c8102e;box-shadow:0 2px 10px rgba(0,0,0,0.06);height:100%;">
          <h4 class="sidebar-title mb-3" style="font-family:'Merriweather',serif;font-size:.92rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;border-bottom:none;padding-bottom:0;color:#c8102e;">
            <i class="fas fa-fire me-1"></i> Trending Now
          </h4>
          <div class="flex-grow-1">
            {% for article in trending_articles %}
            <div class="d-flex align-items-start mb-3 pb-2" style="border-bottom:1px solid #ececec;">
              <span class="fw-bold me-2" style="font-size:1.15rem;color:#c8102e;min-width:26px;line-height:1.3;font-family:'Merriweather',serif;opacity:0.85;">{{ forloop.counter }}</span>
              <div>
                <a href="{% url 'news:detail' article.pk %}" class="text-decoration-none" style="color:#222;">
                  <p class="mb-0" style="font-size:.81rem;font-weight:600;line-height:1.4;">{{ article.title|truncatewords:12 }}</p>
                </a>
                <small class="text-muted" style="font-size:.71rem;">
                  {% if article.is_indian_news %}<span style="color:#FF9933;">üáÆüá≥</span>{% endif %}
                  {{ article.published_at|timesince }} ago
                </small>
              </div>
            </div>
            {% endfor %}
          </div>

          {% with india_articles|slice:"1:2" as spotlight_list %}
          {% for sp in spotlight_list %}
          <div style="border-top:2px solid #eee;padding-top:10px;margin-top:4px;">
            <div style="font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:#c8102e;margin-bottom:6px;">
              <i class="fas fa-star me-1"></i> Editor's Pick
            </div>
            <div class="position-relative overflow-hidden" style="border-radius:8px;">
              {% if sp.image_url %}
              <img src="{{ sp.image_url }}" alt="{{ sp.title }}"
                   style="width:100%;height:80px;object-fit:cover;display:block;border-radius:8px;">
              {% else %}
              <div style="width:100%;height:80px;background:linear-gradient(135deg,#FF9933,#c8102e);border-radius:8px;"></div>
              {% endif %}
              <div style="position:absolute;inset:0;background:linear-gradient(transparent 20%,rgba(0,0,0,0.78));border-radius:8px;padding:8px 10px;display:flex;flex-direction:column;justify-content:flex-end;">
                {% if sp.category %}<span style="font-size:.62rem;font-weight:700;color:#d4af37;text-transform:uppercase;letter-spacing:.5px;">{{ sp.get_category_display }}</span>{% endif %}
                <a href="{% url 'news:detail' sp.pk %}" class="text-decoration-none">
                  <p style="font-size:.78rem;font-weight:700;color:#fff;margin:2px 0 0;line-height:1.3;">{{ sp.title|truncatewords:10 }}</p>
                </a>
              </div>
            </div>
          </div>
          {% endfor %}
          {% endwith %}

        </div>
      </div>
    </div>
  </section>
  {% endif %}

  <section class="india-section mb-5">
    <div class="d-flex align-items-center mb-3 pb-2" style="gap:12px;border-bottom:2px solid #f0f0f0;">
      <div style="width:5px;height:28px;background:linear-gradient(#FF9933 33%,#fff 33%,#fff 66%,#138808 66%);border-radius:4px;flex-shrink:0;"></div>
      <h2 style="font-family:'Merriweather',serif;font-size:1.25rem;font-weight:900;margin:0;">&#127470;&#127475; India Today</h2>
      <a href="{% url 'news:india' %}" class="ms-auto btn btn-sm" style="background:#FF9933;color:#fff;border:none;font-size:.78rem;border-radius:20px;padding:4px 14px;font-weight:600;">View All &rarr;</a>
    </div>
    <div class="row g-3">
      {% if india_articles %}
        {% with india_articles.0 as feat %}
        <div class="col-lg-6">
          <div class="news-card h-100 position-relative" style="border-radius:10px;border-top:3px solid #FF9933;">
            {% if feat.image_url %}
            <img src="{{ feat.image_url }}" alt="{{ feat.title }}" style="width:100%;height:260px;object-fit:cover;border-radius:10px 10px 0 0;">
            {% else %}
            <div style="width:100%;height:260px;background:linear-gradient(135deg,#FF9933,#c8102e);border-radius:10px 10px 0 0;"></div>
            {% endif %}
            <div class="card-body p-3">
              {% if feat.category %}<span class="badge mb-1" style="background:#FF9933;color:#fff;font-size:.7rem;">{{ feat.get_category_display }}</span>{% endif %}
              <h4 style="font-family:'Merriweather',serif;font-size:1.05rem;font-weight:700;line-height:1.35;">
                <a href="{% url 'news:detail' feat.pk %}" class="text-decoration-none text-dark">{{ feat.title|truncatewords:18 }}</a>
              </h4>
              <p class="text-muted small mb-1">{{ feat.description|truncatewords:25 }}</p>
              <small class="text-muted"><i class="far fa-clock"></i> {{ feat.published_at|timesince }} ago &nbsp;|&nbsp; {{ feat.source }}</small>
            </div>
          </div>
        </div>
        {% endwith %}
        <div class="col-lg-6">
          <div class="row g-2">
            {% for article in india_articles|slice:"1:5" %}
            <div class="col-6">
              <div class="news-card h-100" style="border-radius:8px;border-top:2px solid #FF9933;">
                {% if article.image_url %}
                <img src="{{ article.image_url }}" alt="{{ article.title }}" style="width:100%;height:110px;object-fit:cover;border-radius:8px 8px 0 0;">
                {% endif %}
                <div class="p-2">
                  <p style="font-size:.8rem;font-weight:600;margin:0;line-height:1.3;">
                    <a href="{% url 'news:detail' article.pk %}" class="text-decoration-none text-dark">{{ article.title|truncatewords:10 }}</a>
                  </p>
                  <small class="text-muted" style="font-size:.72rem;">{{ article.published_at|timesince }} ago</small>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% for article in india_articles|slice:"5:11" %}
        <div class="col-6 col-md-4 col-lg-2">
          <div class="news-card h-100" style="border-radius:8px;">
            {% if article.image_url %}
            <img src="{{ article.image_url }}" alt="{{ article.title }}" style="width:100%;height:90px;object-fit:cover;border-radius:8px 8px 0 0;">
            {% endif %}
            <div class="p-2">
              <small style="font-size:.78rem;font-weight:600;line-height:1.3;">
                <a href="{% url 'news:detail' article.pk %}" class="text-decoration-none text-dark">{{ article.title|truncatewords:9 }}</a>
              </small>
            </div>
          </div>
        </div>
        {% endfor %}
      {% else %}
      <div class="col-12">
        <div class="alert" style="background:#fff8f0;border:1px solid #FF9933;">
          <i class="fas fa-spinner fa-spin text-warning"></i> India news is being fetched ‚Äî refresh in a moment.
        </div>
      </div>
      {% endif %}
    </div>
  </section>

  <section class="international-section mb-5">
    <div class="d-flex align-items-center mb-3 pb-2" style="gap:12px;border-bottom:2px solid #f0f0f0;">
      <div style="width:5px;height:28px;background:#1a1a1a;border-radius:4px;flex-shrink:0;"></div>
      <h2 style="font-family:'Merriweather',serif;font-size:1.25rem;font-weight:900;margin:0;">&#127758; International</h2>
    </div>
    <div class="row g-3">
      {% for article in international_articles %}
      <div class="col-md-6 col-lg-3">
        <div class="news-card h-100" style="border-radius:10px;border-top:3px solid #1a1a1a;">
          {% if article.image_url %}
          <img src="{{ article.image_url }}" alt="{{ article.title }}" style="width:100%;height:160px;object-fit:cover;border-radius:10px 10px 0 0;">
          {% else %}
          <div style="width:100%;height:160px;background:#1a1a1a;border-radius:10px 10px 0 0;"></div>
          {% endif %}
          <div class="card-body p-3 d-flex flex-column">
            <div class="mb-1">
              {% if article.category %}<span class="badge bg-secondary mb-1" style="font-size:.68rem;">{{ article.get_category_display }}</span>{% endif %}
              {% if article.continent %}<span class="badge mb-1" style="background:#f0f0f0;color:#555;font-size:.68rem;"><i class="fas fa-globe-americas"></i> {{ article.get_continent_display }}</span>{% endif %}
            </div>
            <h6 style="font-family:'Merriweather',serif;font-size:.88rem;font-weight:700;line-height:1.35;">
              <a href="{% url 'news:detail' article.pk %}" class="text-decoration-none text-dark">{{ article.title|truncatewords:14 }}</a>
            </h6>
            <p class="text-muted small mb-2 flex-grow-1">{{ article.description|truncatewords:16 }}</p>
            <small class="text-muted" style="font-size:.75rem;"><i class="far fa-clock"></i> {{ article.published_at|timesince }} ago</small>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12"><p class="text-muted">International articles will appear here shortly.</p></div>
      {% endfor %}
    </div>
  </section>

  <section class="all-news-section mb-5">
    <div class="d-flex align-items-center mb-3 pb-2" style="gap:12px;border-bottom:2px solid #f0f0f0;">
      <div style="width:5px;height:28px;background:#c8102e;border-radius:4px;flex-shrink:0;"></div>
      <h2 style="font-family:'Merriweather',serif;font-size:1.25rem;font-weight:900;margin:0;">Latest News</h2>
      {% if articles %}<span style="font-size:.78rem;color:#888;margin-left:4px;">{{ articles|length }}+ stories</span>{% endif %}
    </div>
    <div class="row g-3">
      {% for article in articles %}
      <div class="col-md-6 col-lg-4">
        <div class="news-card h-100" style="border-radius:10px;border-top:3px solid {% if article.is_indian_news %}#FF9933{% else %}#1a1a1a{% endif %};">
          {% if article.image_url %}
          <img src="{{ article.image_url }}" alt="{{ article.title }}" style="width:100%;height:175px;object-fit:cover;border-radius:10px 10px 0 0;">
          {% else %}
          <div style="width:100%;height:175px;border-radius:10px 10px 0 0;background:{% if article.is_indian_news %}linear-gradient(135deg,#FF9933,#c8102e){% else %}linear-gradient(135deg,#1a1a1a,#333){% endif %};"></div>
          {% endif %}
          <div class="card-body p-3 d-flex flex-column">
            <div class="mb-1 d-flex flex-wrap gap-1">
              {% if article.is_indian_news %}<span class="badge" style="background:#FF9933;color:#fff;font-size:.68rem;">üáÆüá≥ India</span>{% endif %}
              {% if article.category %}<span class="badge bg-secondary" style="font-size:.68rem;">{{ article.get_category_display }}</span>{% endif %}
              {% if article.credibility_score >= 80 %}<span class="badge bg-success" style="font-size:.68rem;"><i class="fas fa-check-circle"></i> Verified</span>
              {% elif article.credibility_score >= 50 and article.credibility_score > 0 %}<span class="badge bg-warning text-dark" style="font-size:.68rem;"><i class="fas fa-exclamation-triangle"></i> Unverified</span>{% endif %}
              {% if article.sentiment == 'positive' %}<span class="badge bg-success" style="font-size:.65rem;"><i class="fas fa-smile"></i></span>
              {% elif article.sentiment == 'negative' %}<span class="badge bg-danger" style="font-size:.65rem;"><i class="fas fa-frown"></i></span>{% endif %}
            </div>
            <h6 style="font-family:'Merriweather',serif;font-size:.9rem;font-weight:700;line-height:1.35;">
              <a href="{% url 'news:detail' article.pk %}" class="text-decoration-none text-dark">{{ article.title|truncatewords:15 }}</a>
            </h6>
            {% if article.tags %}<div class="mb-1">{% for tag in article.tags|slice:":3" %}<span class="badge bg-light text-secondary" style="font-size:.65rem;">#{{ tag }}</span>{% endfor %}</div>{% endif %}
            <p class="text-muted small mb-2 flex-grow-1">{{ article.description|truncatewords:18 }}</p>
            {% if article.ai_summary %}
            <div class="mb-2 p-2 rounded" style="background:#f8f8f8;border-left:3px solid #c8102e;font-size:.78rem;"><strong>AI:</strong> {{ article.ai_summary|truncatewords:12 }}</div>
            {% endif %}
            <div class="d-flex justify-content-between align-items-center mt-auto">
              <small class="text-muted" style="font-size:.75rem;"><i class="far fa-clock"></i> {{ article.published_at|timesince }} ago</small>
              <a href="{% url 'news:detail' article.pk %}" class="btn btn-sm btn-read-more" style="font-size:.75rem;padding:3px 10px;">Read ‚Üí</a>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12">
        <div class="alert alert-info">
          <h5><i class="fas fa-spinner fa-spin"></i> Fetching latest news‚Ä¶</h5>
          <p class="mb-0">News is pulled from Google News every 5 minutes. Refresh shortly.</p>
        </div>
      </div>
      {% endfor %}
    </div>

    {% if is_paginated %}
    <nav class="mt-4">
      <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item"><a class="page-link" href="?page=1">&laquo;&laquo;</a></li>
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
        {% endif %}
        {% for num in page_obj.paginator.page_range %}
          {% if page_obj.number == num %}<li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
          {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}<li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>{% endif %}
        {% endfor %}
        {% if page_obj.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">&raquo;&raquo;</a></li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
  </section>

</div>{% comment %}end .container{% endcomment %}

{# ‚îÄ‚îÄ LEGACY BLOCK kept for compatibility ‚Äî replaced by hero_article above ‚îÄ‚îÄ #}
{% if False %}
{% endif %}
{% endblock %}
